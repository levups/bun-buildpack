#!/usr/bin/env bash

set -e -o pipefail

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

echo "-----> Installing Bun"
export BUN_INSTALL="$HOME/.bun"
curl -fsSL https://bun.sh/install | bash

echo "-----> Exporting profile environment"
mkdir -p $BUILD_DIR/.profile.d
cat <<EOF >$BUILD_DIR/.profile.d/001_bun.sh
export PATH="\$BUN_INSTALL/bin:\$PATH"
EOF

echo "-----> Testing bun"
source $BUILD_DIR/.profile.d/001_bun.sh
command -v bun
ls -l $BUILD_DIR/bun.lockb
bun install
